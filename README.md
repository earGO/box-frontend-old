# Box frontend

Этот проект построен с помощью пакета **lerna**, который используется в работе с моно-репозиториями для JavaScript проектов. Это решение помогает разделять код на независимые друг от друга библиотеки, тем самым позволяя выносить какой-либо функционал в переиспользуемые модули, хранящиеся в директории `packages`.

## Основные команды

- `npm run bootstrap` - устанавливает зависимости для всех модулей
- `npm run dev` - поднимает dev-сервер для локальной разработки и слушает изменения во всех библиотках, собирая в каждой из них свой build, обновляя при этом головние приложение **app**
- `npm run clean` - удаляет загруженные зависимости во всех пакетах

## Packages 

### app
Это главный пакет, который вбирает в себя остальные модули и собирается в обычное SPA-приложение с помощью `react-scripts`. Именно его билд необходимо деплоить на целевые сервера.

#### Файлы и директории приложения
- `src/store.js` - конфигурация **redux** хранилища приложения. В нем подключаются и настраиваются middlewares и reducers
- `src/theme.js` - в этом файле можно перезаписать значения стандартной темы [библиотеки компонентов](design.ursip.ru)
- `assets` - в эту директорию необходимо складывать общие для всех компонентов файлы. Например шрифты, логотипы и так далее
- `pages` - хранит страницы (роуты) приложения

### *-service
Библиотеки с окончанием **service** в названии привязаны к соответсвующим им backend-сервисам. Каждый пакет представляет собой набор [уток](https://github.com/erikras/ducks-modular-redux).

При реализации js-сервиса необходимо придерживаться ряда правил:

* Имя библиотеки должно строится исходя из названия сервиса, которому она соответствует. Например для  `/api/nsi/v1` создаем библиотеку с названием **nsi-service**
* Имя каждой утки должно повторять её java-контроллер, а названия action creators повторяют названия методов этого контроллера. Например в запросе `/api/nsi/v1/catalogs/getAll` контроллер **catalogs** содержит метод **getAll**. Значит в утке `catalogs.js` необходимо создать action creator `getAll`. Такой подход облегчит понимание и скорость решения проблем совместно с backend-разработчиками. 
* При разработке необходимо руководствоваться swagger-документации соответствующего ему backend-сервиса. Каждый backend-сервис хранит свою документацию по адресу: `/api/имя сервиса/v1/`

Основная задача js-сервисов - это изолировать функционал загрузки и хранения данных от остальной ui-логики, так как зачастую при реализации какой-либо утки разработчик в первую очередь начинает с написания функционала для загрузки данных с бэкенда, и в дальнейшем он раздувает этот код какой-либо ui-логикой, усложняя её дальнейшее переиспользование. Напимер: сделать запрос к бэкенду и положить в хранилище нормализованный ответ - это скорее серверный функционал, а отобразить иконку загрузки где-нибудь в интерфейсе в момент выполнения - это уже ui-логика. Такое разделение сокращает вероятность появления ошибок.

### *-ui
В этих пакетах хранятся наборы компонентов-виджетов для соответствующих им сервисам. Из виджетов формируется контент страниц приложения **app**

### utils
Библиотека функций различного назначения для использования в приложении и других библиотеках. 
#### Основные функции
- `injectReducer` - позволяет динамически подключать локальное хранилище прямо в коде компонента-виджета, а не  только через общий конфиг `app/src/store`
- `injectSaga` - тоже самое, но для saga

### Ajax запросы

Для этого используется миддлвара [redux-saga-requests](https://github.com/klis87/redux-saga-requests).